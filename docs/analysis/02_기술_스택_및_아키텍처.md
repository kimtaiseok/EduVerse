# 02. 기술 스택 및 아키텍처

## 전체 기술 스택

### 아키텍처 개요
```
┌─────────────────────────────────────────────────────────────────┐
│                         클라이언트 (브라우저)                        │
├─────────────────────────────────────────────────────────────────┤
│  HTML5 + Tailwind CSS + ES6 Modules                            │
│  ├─ Monaco Editor (코드 편집)                                    │
│  ├─ Pyodide (Python 실행)                                       │
│  └─ Firebase SDK (실시간 DB)                                    │
└──────────────┬──────────────────────────────┬───────────────────┘
               │                              │
               │ HTTP/REST                    │ WebSocket (실시간)
               │                              │
┌──────────────▼──────────────────────────────▼───────────────────┐
│                    Flask 애플리케이션 (main.py)                    │
│  ├─ 26개 API 엔드포인트                                           │
│  ├─ Werkzeug (비밀번호 해싱)                                      │
│  └─ Firebase Admin SDK                                         │
└──────────────┬──────────────────────────────────────────────────┘
               │
               │ Firestore API
               │
┌──────────────▼──────────────────────────────────────────────────┐
│             Google Cloud Firestore (NoSQL DB)                   │
│  ├─ users (사용자)                                               │
│  ├─ scenarios (커리큘럼)                                         │
│  ├─ classes (수업)                                              │
│  ├─ questions (Q&A)                                            │
│  ├─ submission_logs (제출 로그)                                  │
│  └─ reflections (회고)                                          │
└─────────────────────────────────────────────────────────────────┘
```

---

## 백엔드 기술 스택

### Python 런타임
- **버전**: Python 3.9 (컨테이너) / 3.12 (GCP 런타임)
- **환경**: Docker 또는 Google Cloud Run

### 웹 프레임워크
**Flask 2.3.3**
- **선택 이유**: 경량, 빠른 프로토타이핑, RESTful API 구축 용이
- **특징**:
  - 마이크로 프레임워크 (최소한의 의존성)
  - 플라스크 템플릿 엔진 (Jinja2)
  - 라우팅 및 HTTP 메서드 처리

### WSGI 서버
**Gunicorn 20.1.0**
- **설정**: 1 worker, 8 threads
- **타임아웃**: 무제한 (0)
- **포트**: 8080
- **명령어**:
  ```bash
  gunicorn --bind :8080 --workers 1 --threads 8 --timeout 0 main:app
  ```

### 데이터베이스 클라이언트
**Google Cloud Firestore 2.7.2**
- **타입**: NoSQL 문서 데이터베이스
- **특징**:
  - 실시간 동기화
  - 자동 스케일링
  - 서버리스
  - 클라이언트/서버 양방향 접근

**Firebase Admin SDK 6.0.1**
- **용도**: 서버 사이드 Firestore 접근
- **초기화**:
  ```python
  firebase_admin.initialize_app(options={
      'projectId': 'my-python-65210-65c44',
  })
  db = firestore.client()
  ```

### 보안
**Werkzeug 2.3.7**
- **기능**:
  - `generate_password_hash()`: 비밀번호 해싱 (pbkdf2:sha256)
  - `check_password_hash()`: 비밀번호 검증
- **레거시 지원**: 평문 비밀번호 마이그레이션 로직 포함

### Python 의존성 ([requirements.txt](../../requirements.txt:1))
```txt
Flask==2.3.3
Werkzeug==2.3.7
google-cloud-firestore==2.7.2
firebase-admin==6.0.1
gunicorn==20.1.0
```

---

## 프론트엔드 기술 스택

### 코어 기술
- **HTML5**: 시맨틱 마크업
- **CSS3**: Flexbox, Grid, 애니메이션
- **JavaScript**: ES6+ (ES Modules, async/await, Promises)

### CSS 프레임워크
**Tailwind CSS (CDN)**
- **버전**: Latest (CDN 자동 업데이트)
- **URL**: `https://cdn.tailwindcss.com`
- **사용 패턴**: Utility-first CSS
- **주요 클래스**:
  - 레이아웃: `flex`, `grid`, `container`
  - 색상: `bg-gray-900`, `text-white`, `text-yellow-300`
  - 반응형: `md:`, `lg:` 브레이크포인트

### 코드 에디터
**Monaco Editor 0.44.0**
- **기반**: Visual Studio Code 엔진
- **언어**: Python 구문 강조
- **테마**: VS Dark
- **CDN**: `https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/`
- **기능**:
  - 구문 강조 (Syntax Highlighting)
  - 자동 완성 (IntelliSense)
  - 줄 번호 표시
  - 모바일/데스크톱 듀얼 인스턴스

**초기화 코드** ([codeEditor.js:40-48](../../static/codeEditor.js:40-48)):
```javascript
require.config({
  paths: {
    vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs",
  },
  "vs/nls": {
    availableLanguages: { "*": "ko" },
  },
});
```

### Python 런타임
**Pyodide v0.25.1**
- **정의**: WebAssembly로 컴파일된 CPython 3.11
- **CDN**: `https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js`
- **특징**:
  - 브라우저 내 Python 실행 (서버 불필요)
  - NumPy, Pandas 등 과학 라이브러리 지원
  - 표준 라이브러리 포함
- **로딩 시간**: 초기 로딩 ~3-5초
- **실행 방식**:
  ```javascript
  await pyodide.runPythonAsync(code);
  ```

### 데이터베이스 SDK
**Firebase JavaScript SDK v9.6.10 (Modular)**
- **CDN**: `https://www.gstatic.com/firebasejs/9.6.10/`
- **모듈**:
  - `firebase-app.js`: 앱 초기화
  - `firebase-firestore.js`: Firestore 클라이언트
- **사용 패턴**:
  ```javascript
  import { initializeApp } from "firebase-app.js";
  import { getFirestore, onSnapshot } from "firebase-firestore.js";
  ```

### 데이터 시각화
**Chart.js (Latest)**
- **용도**: 분석 리포트 차트 렌더링
- **차트 타입**: Line, Bar, Radar
- **CDN**: `https://cdn.jsdelivr.net/npm/chart.js`

### UI 라이브러리
**Lucide Icons (Latest)**
- **용도**: 아이콘 렌더링
- **CDN**: `https://unpkg.com/lucide@latest`
- **초기화**: `lucide.createIcons()`

**Typed.js 2.0.16**
- **용도**: 타이핑 애니메이션 효과
- **CDN**: `https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js`
- **사용 위치**: 캐릭터 대사 연출

---

## 프론트엔드 아키텍처

### ES6 모듈 구조
```
main.js (진입점)
├─ state.js (전역 상태)
├─ auth.js (인증)
├─ ui.js (UI 컴포넌트)
├─ learningModal.js (학습 모달)
├─ codeEditor.js (코드 편집/실행)
├─ firebase.js (실시간 DB)
└─ config.js (상수)

monitor.js (독립 앱 - 교수자 모니터)
report.js (독립 앱 - 분석 리포트)
growth.js (독립 앱 - 성장 트래킹)
```

### 상태 관리
**Centralized State Pattern** ([state.js](../../static/state.js:1-18))
```javascript
export let state = {
  currentUser: null,              // 현재 사용자
  currentWeek: 1,                 // 현재 주차
  currentCycleIndex: 0,           // 현재 사이클
  currentModalType: null,         // 현재 모달
  previousModalType: null,        // 이전 모달
  weekData: null,                 // 주차 데이터
  syntaxDb: null,                 // 문법 DB
  classes: [],                    // 클래스 목록
  monacoEditor: null,             // 데스크톱 에디터
  monacoEditorMobile: null,       // 모바일 에디터
};
```

### 모듈 역할

| 모듈 | 책임 | 주요 함수 |
|------|------|----------|
| `main.js` | 앱 초기화, 이벤트 리스너 | `initializeApp()`, `loadAndStartCycle()` |
| `state.js` | 전역 상태 관리 | `state` 객체 export |
| `auth.js` | 인증 로직 | `handleLoginSubmit()`, `logout()` |
| `ui.js` | UI 렌더링 | `showView()`, `updateDashboardUI()` |
| `learningModal.js` | 모달 관리 | `showModal()`, `handleAction()` |
| `codeEditor.js` | 코드 실행 | `initializePyodide()`, `runPythonCode()` |
| `firebase.js` | 실시간 DB | `sendLiveCode()`, `setupAnswerListener()` |
| `config.js` | 설정 상수 | `IMAGE_URLS`, `CURRICULUM`, `syntaxMap` |

---

## 인프라 및 배포

### 컨테이너화
**Docker**
- **베이스 이미지**: `python:3.9-slim`
- **작업 디렉토리**: `/app`
- **포트**: 8080
- **Dockerfile** ([Dockerfile](../../Dockerfile:1-10)):
  ```dockerfile
  FROM python:3.9-slim
  WORKDIR /app
  COPY requirements.txt .
  RUN pip install --no-cache-dir -r requirements.txt
  COPY main.py .
  COPY templates ./templates
  COPY static ./static
  CMD exec gunicorn --bind :8080 --workers 1 --threads 8 --timeout 0 main:app
  ```

### Google Cloud Platform
**Cloud Run 배포**
- **런타임**: Python 3.12 (app.yaml 설정)
- **설정 파일**: `app.yaml`
- **정적 파일 처리**: `/static` 직접 서빙
- **동적 라우팅**: 나머지 모든 경로

**app.yaml** ([app.yaml](../../app.yaml:1-7)):
```yaml
runtime: python312
handlers:
  - url: /static
    static_dir: static
  - url: /.*
    script: auto
```

**배포 명령어**:
```bash
# Docker 이미지 빌드 및 배포
gcloud run deploy eduverse --source .

# 또는 직접 빌드
docker build -t eduverse .
docker run -p 8080:8080 eduverse
```

### Firebase 프로젝트
- **프로젝트 ID**: `my-python-65210-65c44`
- **리전**: 기본 (자동 할당)
- **서비스**:
  - Firestore Database
  - Authentication (이메일/비밀번호)

---

## 개발 환경 구성

### 로컬 개발
```bash
# 1. 의존성 설치
pip install -r requirements.txt

# 2. Flask 개발 서버 실행
python main.py
# → http://localhost:5000

# 3. 또는 Gunicorn으로 실행
gunicorn --bind :8080 --workers 1 --threads 8 main:app
# → http://localhost:8080
```

### 환경 변수
**현재**: 환경 변수 없음 (Firebase Project ID 하드코딩)
**개선 필요**:
```python
# 권장 패턴
import os
PROJECT_ID = os.getenv('FIREBASE_PROJECT_ID', 'my-python-65210-65c44')
```

---

## 의존성 분석

### 백엔드 의존성 그래프
```
Flask 2.3.3
├─ Werkzeug 2.3.7 (WSGI 유틸리티)
├─ Jinja2 (템플릿 엔진)
├─ Click (CLI 도구)
└─ ItsDangerous (세션 서명)

Firebase Admin 6.0.1
├─ google-cloud-firestore 2.7.2
│  ├─ google-api-core
│  ├─ google-cloud-core
│  └─ protobuf
└─ google-auth

Gunicorn 20.1.0
└─ (독립 실행)
```

### 프론트엔드 의존성
**모두 CDN 기반** (로컬 번들링 없음)
- ✅ **장점**: 빌드 프로세스 불필요, 빠른 캐싱
- ⚠️ **단점**: 네트워크 의존, 버전 고정 어려움, 오프라인 불가

---

## 아키텍처 패턴

### 백엔드 패턴
1. **Monolithic Architecture**: 단일 Flask 앱
2. **RESTful API**: HTTP 메서드 기반 엔드포인트
3. **Serverless-Ready**: 상태 비저장 (Stateless) 설계
4. **Document-Oriented DB**: Firestore NoSQL

### 프론트엔드 패턴
1. **SPA (Single Page Application)**: 클라이언트 사이드 라우팅
2. **ES6 Modules**: 모듈화된 코드 구조
3. **Centralized State**: 단일 상태 객체 패턴
4. **Event-Driven UI**: 이벤트 리스너 기반 인터랙션

### 실시간 동기화 패턴
1. **Firestore Snapshot Listeners**: 실시간 데이터 구독
2. **Debounced Updates**: 1초 디바운스로 네트워크 부하 감소
3. **Optimistic UI**: 로컬 상태 즉시 업데이트

---

## 성능 고려사항

### 최적화
- ✅ Pyodide 초기화 비동기 처리
- ✅ 1초 debounce로 Live Code 업데이트 제한
- ✅ Monaco Editor 지연 로딩
- ✅ Firestore 인덱싱 활용

### 개선 가능 영역
- ⚠️ CDN 의존성 로컬 번들링
- ⚠️ 이미지 최적화 (WebP, lazy loading)
- ⚠️ Service Worker 캐싱
- ⚠️ Code Splitting (큰 script.js 파일)

---

## 다음 단계
다음 문서에서는 백엔드 구조와 API 엔드포인트를 상세히 분석합니다.

→ [03. 백엔드 분석](./03_백엔드_분석.md)
